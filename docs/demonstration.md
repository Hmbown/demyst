# Demyst Demonstration

This document showcases Demyst's ability to detect scientific integrity issues in Python code.

## 1. The Swarm Collapse Scenario (Nov 2025)

**Scenario**: A swarm of 1,000 agents. 999 are perfectly aligned (1.0), but 1 is rogue (0.0).
**The Danger**: A simple mean calculation hides the rogue agent (`mean = 0.999`), leading to a catastrophic deployment.

### The Code (`examples/swarm_collapse.py`)

```python
def analyze_swarm_safety(agent_count=1000):
    # ... setup ...
    swarm_alignment = np.ones(agent_count)
    swarm_alignment[-1] = 0.0 
    
    # --- The Computational Mirage ---
    # The safety engineer looks at the mean alignment.
    mean_alignment = np.mean(swarm_alignment)
    
    return mean_alignment
```

### Demyst Detection

Running `demyst mirage examples/swarm_collapse.py` instantly flags the issue:

```text
============================================================
COMPUTATIONAL MIRAGES DETECTED
============================================================

Line 24: mean()
  Function: analyze_swarm_safety
  Impact: Destroys variance/distribution information
  Fix: Use VariationTensor(mean).collapse('mean')

Total mirages: 1
```

## 2. Basic Integrity Check

**Scenario**: A random walk analysis that performs destructive operations and premature discretization.

### The Code (`examples/random_walk.py`)

```python
def analyze_random_walk(steps=1000):
    walk = np.cumsum(np.random.normal(0, 1, steps))
    
    # Destructive operations
    mean_pos = np.mean(walk)
    
    # Premature discretization
    discrete_mean = int(mean_pos)
    
    return mean_pos, max_pos, discrete_mean
```

### Demyst Analysis

Running `demyst analyze examples/random_walk.py` produces a detailed JSON report:

```json
{
  "mirage": {
    "issues": [
      {
        "type": "mean",
        "line": 12,
        "description": "Computational mirage: mean operation destroys variance information"
      },
      {
        "type": "premature_discretization",
        "line": 17,
        "description": "Computational mirage: premature_discretization operation destroys variance information"
      }
    ]
  }
}
```

## 3. Automated Methodology Generation

Demyst can automatically generate a LaTeX methodology section guaranteeing that the code matches the paper.

**Command**:
```bash
demyst paper examples/swarm_collapse.py -o methodology.tex
```

**Output**:
```latex
\section{Methodology}
\label{sec:methodology}

% Auto-generated by Demyst Paper Generator
% This section is guaranteed to match the executed code.

\subsection{Reproducibility}
All experiments are tracked using the Demyst scientific integrity framework.
...
```

## 4. Physics: Dimensional Analysis

**Scenario**: A kinematics calculation that accidentally adds time to distanceâ€”a physical impossibility.

### The Code (`examples/physics_kinematics.py`)

```python
def calculate_trajectory(time_seconds, initial_velocity_mps):
    # ...
    # ERROR: Adding Time to Distance
    total_metric = distance_x + time_seconds
    return total_metric
```

### Demyst Detection

```text
FAIL: Critical dimensional inconsistencies detected.

Line 17: distance_x + time_seconds
  Type: incompatible_addition
  Description: Cannot add quantities with dimensions [L] and [T].
  Meaning: This is like adding meters to seconds. The result has no physical meaning.
```

## 5. Biology: P-Hacking Detection

**Scenario**: A gene expression analysis that runs 1,000 t-tests without correction and only reports the "significant" ones.

### The Code (`examples/biology_gene_expression.py`)

```python
for gene_idx in range(num_genes):
    # Run t-test for each gene
    t_stat, p_val = ttest_ind(control_group[gene_idx], treatment_group[gene_idx])
    
    # ERROR: Conditional reporting / P-hacking
    if p_val < 0.05:
        print(f"Gene_{gene_idx} is SIGNIFICANT!")
```

### Demyst Detection

```text
FAIL: Invalid statistical practices detected.

Line 21: ttest_ind
  Type: uncorrected_multiple_tests
  Description: Statistical test called inside a loop. Multiple comparisons require p-value correction.
  Impact: With 20 tests at alpha=0.05, you have a 64% chance of false positives.
```

## 6. Chemistry: Stoichiometry Checks

**Scenario**: Mixing up mass and moles in a concentration calculation.

### The Code (`examples/chemistry_stoichiometry.py`)

```python
def calculate_molarity(mass_g, molar_mass_g_mol, volume_l):
    moles = mass_g / molar_mass_g_mol
    
    # ERROR: Adding Mass to Moles
    total_substance = mass_g + moles
```

### Demyst Detection

```text
FAIL: Critical dimensional inconsistencies detected.

Line 11: mass_g + moles
  Type: incompatible_addition
  Description: Cannot add quantities with dimensions [M] and [1].
  Meaning: This is like adding apples to oranges.
```

